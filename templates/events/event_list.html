{% extends "users/basic.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="glass-section">
        <h2 class="section-title mb-4">Live Events</h2>

        <!-- Search and Filter Section -->
        <div class="row mb-4">
            <div class="col-md-8">
                <form method="get" class="form-inline">
                    <div class="input-group w-100">
                        <input type="text" name="search" class="form-control" placeholder="Search events..." value="{{ request.GET.search|default:'' }}">
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="submit">Search</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-md-4">
                <select class="form-control" name="category" onchange="this.form.submit()">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                    <option value="{{ category.slug }}" {% if request.GET.category == category.slug %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Date Filter Pills -->
        <div class="mb-4">
            <div class="btn-group" role="group">
                <a href="?{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}date=today" 
                   class="btn btn-outline-primary {% if request.GET.date == 'today' %}active{% endif %}">Today</a>
                <a href="?{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}date=tomorrow" 
                   class="btn btn-outline-primary {% if request.GET.date == 'tomorrow' %}active{% endif %}">Tomorrow</a>
                <a href="?{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}date=this_weekend" 
                   class="btn btn-outline-primary {% if request.GET.date == 'this_weekend' %}active{% endif %}">This Weekend</a>
                <a href="?{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}{% if request.GET.search %}search={{ request.GET.search }}{% endif %}" 
                   class="btn btn-outline-primary {% if not request.GET.date %}active{% endif %}">All Dates</a>
            </div>
        </div>

        <!-- Events Grid -->
        <div class="row">
            {% if events %}
                {% for event in events %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <img src="{{ event.image.url }}" class="card-img-top" alt="{{ event.name }}" style="height: 200px; object-fit: cover;">
                        <div class="card-body">
                            <h5 class="card-title">{{ event.name }}</h5>
                            <p class="card-text">
                                <small class="text-muted">
                                    <i class="fas fa-calendar"></i> {{ event.event_date|date:"D, M d, Y" }}<br>
                                    <i class="fas fa-clock"></i> {{ event.start_time|time:"g:i A" }}
                                </small>
                            </p>
                            <p class="card-text">
                                <i class="fas fa-map-marker-alt"></i> {{ event.venue }}
                            </p>
                            <p class="card-text">
                                <span class="badge badge-primary">{{ event.category.name }}</span>
                                {% if event.status == 'upcoming' %}
                                    <span class="badge badge-success">{{ event.status|title }}</span>
                                {% elif event.status == 'ongoing' %}
                                    <span class="badge badge-warning">{{ event.status|title }}</span>
                                {% else %}
                                    <span class="badge badge-secondary">{{ event.status|title }}</span>
                                {% endif %}
                            </p>
                            <p class="card-text">
                                <strong>From â‚¹{{ event.price_from|floatformat:2 }}</strong>
                            </p>
                            <a href="{% url 'events:event_detail' event.slug %}" class="btn btn-primary">View Details</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="col-12">
                    <div class="alert alert-info">
                        No events found matching your criteria.
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}